# 埋点如何设计？

一、埋点

- 埋点：又称为事件追踪（Event Tracking），指的是针对特定用户行为或事件进行捕获，处理和发送的相关技术及其实施过程。
- 功能方面，埋点是用来收集用户行为数据。比如想要了解一个用户在APP里面点击了哪些按钮，看了哪些页面，做了哪些事情等，就可以通过埋点来实现。
- 实现方式方面，埋点就是通过植入一段代码到某个页面或某个按钮，从而监听用户行为并进行收集上报。

二、埋点SDK

- SDK：Software Development Kit（软件开发工具包），包括某类软件功能的相关文档，api，软件，框架之类的集合
- 理解SDK：可以把SDK看成一个虚拟的程序包，这个包里面有一份已经开发完成的软件某一功能，包是几乎全封闭的，只通过API联通外界。（可以把盒装饮料看作“SDK”，吸管看作“API”）
- 埋点SDK：封装采集用户数据的代码，形成一个组件。这个SDK可以实现基本的数据收集功能。

三、埋点的事件分类（埋点类型）

1. 页面事件：用户访问页面的信息，比如可以通过页面埋点统计页面浏览量（PV）；
2. 点击事件：用户在页面的点击行为，比如想要收集用户点击搜索按钮时，填入了哪些关键字，就可以在搜索按钮上埋一个点击事件，通过字段keywords上报的值实现分析关键字的目的；
3. 曝光事件：用户浏览页面的区域，比如统计某个区域是否被浏览过，需要进行曝光埋点；
4. 停留事件：用户访问页面的停留时长的信息，比如某APP定义用户在文章页面停留为一个埋点，获取除返回后台的停留时长，重新切入页面累计时长，用来分析喜好情况。

四、埋点的事件组成（埋点属性）

1. 用户基本信息：描述用户的基本属性信息，包括用户ID，性别，运营商，设备类型等
2. 时间信息：事件发生的时间
3. 行为信息：用户做了哪些行为，比如点击行为，浏览行为等
4. 行为对象信息：用户的行为作用在哪些对象上，比如点击按钮A，浏览页面B，那么A，B就是用户行为作用对象
5. 另外，也可以从4w1h（who,when,where,what,how）五个维度来划分埋点属性

五、埋点的优点

- 通过有效的埋点，可以收集和观察到用户在使用产品中的第一手数据资料
- 最真实的反映产品的运行情况，是量化工作效益，计算ROI和KPI，通过数据来分析问题的重要依据
- 实现埋点的代价最低，收益最高

六、埋点技术

- 代码埋点
- 可视化埋点
- 无埋点（全埋点）



# 二维码扫码登录

![](https://pic1.zhimg.com/v2-3c5abf2d6431f467399c6517671de655_r.jpg?source=1940ef5c)

1. 访问PC端二维码生成页面，PC端请求服务端获取二维码ID
2. 服务端生成相应的二维码ID，设置二维码的过期时间，状态等。
3. PC获取二维码ID，生成相应的二维码。
4. 手机端扫描二维码，获取二维码ID。
5. 手机端将手机端token和二维码ID发送给服务端，确认登录。
6. 服务端校验手机端token，根据手机端token和二维码ID生成PC端token
7. PC端通过轮询方式，通过二维码ID获取二维码状态，如果已成功，返回PC token，登录成功。

>PC端可以通过获取二维码的状态来进行相应的响应：
>
>- 二维码`未扫描`：无操作
>- 二维码`已失效`：提示刷新二维码
>- 二维码`已成功`：从服务端获取PC token
>
>获取二维码状态，主要有三种方式：
>
>- **轮询**：轮询方式是指客户端会每隔一段时间就主动给服务端发送一次二维码状态的查询请求。
>- **长轮询**：长轮询是指客户端主动给服务端发送二维码状态的查询请求，服务端会按情况对请求进行阻塞，直至二维码信息更新或超时。当客户端接收到返回结果后，若二维码仍未被扫描，则会继续发送查询请求，直至状态变化（已失效或已成功）。
>- **Websocket**：Websocket是指前端在生成二维码后，会与后端建立连接，一旦后端发现二维码状态变化，可直接通过建立的连接主动推送信息给前端。



